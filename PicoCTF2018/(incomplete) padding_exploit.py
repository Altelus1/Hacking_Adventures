import socket                                                                                                  
                                                                                                               
                                                                                                               
                                                                                                               
HOST = "127.0.0.1"                                                                                             
PORT = 6246                                                                                                    
                                                                                                               
scl = socket.socket(socket.AF_INET, socket.SOCK_STREAM)                                                        
scl.connect((HOST, PORT))                                                                                      
                                                                                                               
print(scl.recv(1024))                                                                                          
                                                                                                               
msg = scl.recv(1024)                                                                                           
cookie = msg.split(b"\n")[0].split(b":")[1].replace(b" ",b"")                                                  
cookie = bytes.fromhex(cookie.decode('latin-1'))                                                               
cookie = [cookie[i*16:(i+1)*16] for i in range(int(len(cookie)/16))]                                           
                                                                                                               
cookie = cookie[::-1]                                                                                          
                                                                                                               
fake_block = b''                                                                                               
IV=b"This is an IV456"                                                                                         
                                                                                                               
decrypted = b''                                                                                                
container = b''                                                                                                
                                                                                                               
scl.close()                                                                                                    
scl.connect((HOST, PORT))                                                                                      
scl.recv(1024)                                                                                                 
scl.recv(1024)                                                                                                 
                                                                                                               
for block in cookie:                                                                                           
        for count in range(16):                                                                                
                for i in range(256):                                                                           
                        fake_block = bytes([i]) * (len(container)-16) + container                              
                        print(b'[*] Trying: '+fake_block)                                                      
                        to_send = IV.hex()+fake_block.hex()+block.hex()                                        
                        scl.sendall(to_send.encode('latin-1'))                                                 
                                                                                                               
                        resp = scl.recv(1024)                                                                  
                                                                                                               
                        if b'JSON' in resp:                                                                    
                                print(b'[*] Found: '+bytes([i]))                                               
                                decrypted = bytes([i]) + decrypted                                             
                                container = bytes([(i^count) & 0xff]) + contianer                              
                                                                                                               
                                                                                                               
                                                                                                               
                        scl.close()                                                                            
                                                                                                               
                        scl.connect((HOST,PORT))                                                               
                        scl.recv(1024)                                                                         
                        scl.recv(1024)                                                                         
